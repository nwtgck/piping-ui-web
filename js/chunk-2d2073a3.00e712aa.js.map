{"version":3,"sources":["webpack:///./src/components/DataDownloader.vue?f189","webpack:///./src/components/DataDownloader.vue","webpack:///./src/components/DataDownloader.vue?b771","webpack:///./src/components/DataDownloader.vue?ef24"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","hasError","_v","_s","strings","props","downloadNo","protection","type","verificationStep","_e","verificationCode","staticClass","downloadPath","errorMessage","staticRenderFns","$el","keyExchangeAndReceiveVerified","serverUrl","secretPath","step","keyExchangeRes","language","key","downloadUrl","fileName","decryptErrorMessage","mdi","verified","encodeURI","components","VerificationCode","component","VAlert","VExpansionPanel","VExpansionPanelContent","VExpansionPanelHeader","VSimpleTable"],"mappings":"uHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,oBAAoB,CAACA,EAAG,2BAA2B,CAACE,MAAM,CAAC,sBAAsBN,EAAIO,WAAW,CAACH,EAAG,OAAO,CAACJ,EAAIQ,GAAGR,EAAIS,GAAGT,EAAIU,QAAQ,2BAA2B,KAAKV,EAAIS,GAAGT,EAAIW,MAAMC,iBAAiBR,EAAG,4BAA4B,CAAgC,iBAA9BJ,EAAIW,MAAME,WAAWC,MAAyD,YAA9Bd,EAAIe,iBAAiBD,KAAoBV,EAAG,UAAU,CAACE,MAAM,CAAC,KAAO,SAAS,CAACF,EAAG,OAAO,GAAG,CAACJ,EAAIQ,GAAGR,EAAIS,GAAGT,EAAIU,QAAQ,4BAA4BV,EAAIgB,KAAoC,iBAA9BhB,EAAIW,MAAME,WAAWC,MAAyD,8BAA9Bd,EAAIe,iBAAiBD,KAAsCV,EAAG,OAAO,CAACA,EAAG,mBAAmB,CAACE,MAAM,CAAC,MAAQN,EAAIe,iBAAiBE,qBAAqB,GAAGjB,EAAIgB,KAAKZ,EAAG,iBAAiB,CAACc,YAAY,aAAa,CAACd,EAAG,QAAQ,CAACA,EAAG,KAAK,CAACc,YAAY,aAAa,CAACd,EAAG,KAAK,CAACJ,EAAIQ,GAAGR,EAAIS,GAAGT,EAAIU,QAAQ,oBAAoBN,EAAG,KAAK,CAACJ,EAAIQ,GAAGR,EAAIS,GAAGT,EAAImB,uBAAuBf,EAAG,UAAU,CAACE,MAAM,CAAC,KAAO,QAAQ,SAAW,GAAG,MAAQN,EAAIO,WAAW,CAACP,EAAIQ,GAAG,IAAIR,EAAIS,GAAGT,EAAIoB,gBAAgB,QAAQ,IAAI,IAC1iCC,EAAkB,G,6LC6DD,EAArB,yG,0BAGU,EAAAD,aAA6B,iBAAM,IACnC,EAAAL,iBAAqC,CAACD,KAAM,WAJtD,6NA0CI,OAAuBb,KAAKqB,KA1ChC,SA6CwC,OA7CxC,8BA6C2DC,8BACrDtB,KAAKU,MAAMa,UACXvB,KAAKU,MAAMc,WACXxB,KAAKU,MAAME,YACX,SAACa,GACC,EAAKX,iBAAmBW,KAlDhC,UA6CUC,EA7CV,OAuDgC,UAAxBA,EAAeb,KAvDvB,uBAwDMb,KAAKmB,aAAe,kBAAMO,EAAeP,aAAa,OAAYQ,WAxDxE,iCA2DWC,EAAOF,EAAPE,IA3DX,UA8DU,OAAiC,CACrCC,YAAa7B,KAAKkB,aAClBY,SAAU9B,KAAKU,MAAMc,WACrBI,MACAG,oBAAqB/B,KAAKS,QAAQ,6BAlExC,wIAQI,OAAO,OAAAA,EAAA,MAAQ,OAAYkB,YAR/B,+BAYI,MAA+B,KAAxB3B,KAAKmB,iBAZhB,iCAgBI,OAAInB,KAAKM,SACA0B,EAAA,KAEAA,EAAA,OAnBb,sCAwBI,OAAIhC,KAAKM,SACA,aAEP,IA3BN,wCAgCI,MAAsC,iBAA/BN,KAAKU,MAAME,WAAWC,MAAyD,aAA/Bb,KAAKc,iBAAiBD,MAAuBb,KAAKc,iBAAiBmB,WAhC9H,mCAoCI,OAAO,IAAQjC,KAAKU,MAAMa,UAAWW,UAAUlC,KAAKU,MAAMc,iBApC9D,GAA4C,QAClC,gBAAP,kB,4BADkB,EAAc,gBALlC,eAAU,CACTW,WAAY,CACVC,mBAAA,SAGiB,WC9D+a,I,6FCOhcC,EAAY,eACd,EACAvC,EACAsB,GACA,EACA,KACA,KACA,MAIa,aAAAiB,EAAiB,QAShC,IAAkBA,EAAW,CAACC,SAAA,KAAOC,kBAAA,KAAgBC,yBAAA,KAAuBC,wBAAA,KAAsBC,eAAA","file":"js/chunk-2d2073a3.00e712aa.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-expansion-panel',[_c('v-expansion-panel-header',{attrs:{\"disable-icon-rotate\":_vm.hasError}},[_c('span',[_vm._v(_vm._s(_vm.strings['download_in_downloader'])+\" #\"+_vm._s(_vm.props.downloadNo))])]),_c('v-expansion-panel-content',[(_vm.props.protection.type === 'passwordless' && _vm.verificationStep.type === 'initial')?_c('v-alert',{attrs:{\"type\":\"info\"}},[_c('span',{},[_vm._v(_vm._s(_vm.strings['waiting_for_sender']))])]):_vm._e(),(_vm.props.protection.type === 'passwordless' && _vm.verificationStep.type === 'verification_code_arrived')?_c('span',[_c('VerificationCode',{attrs:{\"value\":_vm.verificationStep.verificationCode}})],1):_vm._e(),_c('v-simple-table',{staticClass:\"text-left\"},[_c('tbody',[_c('tr',{staticClass:\"text-left\"},[_c('td',[_vm._v(_vm._s(_vm.strings['download_url']))]),_c('td',[_vm._v(_vm._s(_vm.downloadPath))])])])]),_c('v-alert',{attrs:{\"type\":\"error\",\"outlined\":\"\",\"value\":_vm.hasError}},[_vm._v(\" \"+_vm._s(_vm.errorMessage())+\" \")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* eslint-disable no-console */\n\nimport { Component, Prop, Vue } from 'vue-property-decorator';\nimport urlJoin from 'url-join';\nimport {mdiAlert, mdiChevronDown} from \"@mdi/js\";\n\nimport {globalStore} from \"@/vue-global\";\nimport {strings} from \"@/strings\";\nimport * as pipingUiUtils from \"@/piping-ui-utils\";\nimport type {Protection, VerificationStep} from \"@/datatypes\";\nimport VerificationCode from \"@/components/VerificationCode.vue\";\nimport {pipingUiAuthAsync} from \"@/pipingUiAuthWithWebpackChunkName\"\n\nexport type DataDownloaderProps = {\n  downloadNo: number,\n  serverUrl: string,\n  secretPath: string,\n  protection: Protection,\n};\n\n// NOTE: Automatically download when mounted\n@Component({\n  components: {\n    VerificationCode,\n  },\n})\nexport default class DataDownloader extends Vue {\n  @Prop() private props!: DataDownloaderProps;\n\n  private errorMessage: () => string = () => \"\";\n  private verificationStep: VerificationStep = {type: 'initial'};\n\n  // for language support\n  private get strings() {\n    return strings(globalStore.language);\n  }\n\n  private get hasError(): boolean {\n    return this.errorMessage() !== \"\";\n  }\n\n  private get headerIcon(): string {\n    if (this.hasError) {\n      return mdiAlert;\n    } else {\n      return mdiChevronDown;\n    }\n  }\n\n  private get headerIconColor(): string | undefined {\n    if (this.hasError) {\n      return \"error\";\n    } else {\n      return undefined\n    }\n  }\n\n  private get isReadyToDownload(): boolean {\n    return this.props.protection.type === 'passwordless' ? this.verificationStep.type === 'verified' && this.verificationStep.verified : true\n  }\n\n  private get downloadPath(): string {\n    return urlJoin(this.props.serverUrl, encodeURI(this.props.secretPath));\n  }\n\n  async mounted() {\n    // Scroll to this element\n    // NOTE: no need to add `await`\n    pipingUiUtils.scrollTo(this.$el);\n\n    // Key exchange\n    const keyExchangeRes = await (await pipingUiAuthAsync).keyExchangeAndReceiveVerified(\n      this.props.serverUrl,\n      this.props.secretPath,\n      this.props.protection,\n      (step: VerificationStep) => {\n        this.verificationStep = step;\n      }\n    );\n\n    // If error\n    if (keyExchangeRes.type === \"error\") {\n      this.errorMessage = () => keyExchangeRes.errorMessage(globalStore.language);\n      return;\n    }\n    const {key} = keyExchangeRes;\n\n    // Decrypting & Download\n    await pipingUiUtils.decryptingDownload({\n      downloadUrl: this.downloadPath,\n      fileName: this.props.secretPath,\n      key,\n      decryptErrorMessage: this.strings['password_might_be_wrong'],\n    });\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataDownloader.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/vuetify-loader/lib/loader.js??ref--20-0!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataDownloader.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./DataDownloader.vue?vue&type=template&id=805a7b00&\"\nimport script from \"./DataDownloader.vue?vue&type=script&lang=ts&\"\nexport * from \"./DataDownloader.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VSimpleTable } from 'vuetify/lib/components/VDataTable';\ninstallComponents(component, {VAlert,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VSimpleTable})\n"],"sourceRoot":""}