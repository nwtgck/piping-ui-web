(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["piping-ui-auth"],{acf5:function(e,t,r){"use strict";r.r(t),r.d(t,"verifiedPath",(function(){return v})),r.d(t,"keyExchange",(function(){return j})),r.d(t,"keyExchangeAndReceiveVerified",(function(){return m}));r("99af"),r("a15b"),r("ace4"),r("d3b7"),r("3ca3"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("ddb0");var n=r("d0af"),c=(r("96cf"),r("c964")),a=r("434c"),u=Object(a["obj"])({d:Object(a["opt"])(a["str"]),r:Object(a["opt"])(a["str"]),t:Object(a["opt"])(a["str"])}),i=Object(a["obj"])({alg:Object(a["opt"])(a["str"]),crv:Object(a["opt"])(a["str"]),d:Object(a["opt"])(a["str"]),dp:Object(a["opt"])(a["str"]),dq:Object(a["opt"])(a["str"]),e:Object(a["opt"])(a["str"]),ext:Object(a["opt"])(a["bool"]),k:Object(a["opt"])(a["str"]),key_ops:Object(a["opt"])(Object(a["arr"])(a["str"])),kty:Object(a["literal"])("EC"),n:Object(a["opt"])(a["str"]),oth:Object(a["opt"])(Object(a["arr"])(u)),p:Object(a["opt"])(a["str"]),q:Object(a["opt"])(a["str"]),qi:Object(a["opt"])(a["str"]),use:Object(a["opt"])(a["str"]),x:Object(a["opt"])(a["str"]),y:Object(a["opt"])(a["str"])}),s=Object(a["obj"])({version:a["num"],encryptPublicJwk:i}),o=Object(a["obj"])({verified:a["bool"]}),p=r("1579"),b=function(){return Promise.resolve().then(r.bind(null,"7dda"))},d=function(){return r.e("chunk-221256f0").then(r.t.bind(null,"62f3",7))},f=function(){return r.e("chunk-2d21e767").then(r.t.bind(null,"d654",7)).then((function(e){return e.uint8ArrayToString}))},y=function(){return Promise.resolve().then(r.t.bind(null,"4ff6",7)).then((function(e){return e.default}))};function l(e,t){return h.apply(this,arguments)}function h(){return h=Object(c["a"])(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return n=e.sent,e.abrupt("return",n.sha256("".concat(r,"/key_exchange/").concat(t)));case 4:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function v(e){return x.apply(this,arguments)}function x(){return x=Object(c["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:return r=e.sent,e.abrupt("return",r.sha256("".concat(t,"/verified")));case 4:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function j(e,t,r){return k.apply(this,arguments)}function k(){return k=Object(c["a"])(regeneratorRuntime.mark((function e(t,r,c){var u,i,o,p,b,d,f,h,v,x,j,k,w,m,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=1,i=256,e.next=4,window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey","deriveBits"]);case 4:return o=e.sent,e.next=7,crypto.subtle.exportKey("jwk",o.publicKey);case 7:return p=e.sent,b={version:u,encryptPublicJwk:p},e.next=11,y();case 11:return d=e.sent,e.next=14,l(r,c);case 14:return f=e.sent,e.next=17,l("sender"===r?"receiver":"sender",c);case 17:return h=e.sent,e.next=20,Promise.all([fetch(d(t,f),{method:"POST",body:JSON.stringify(b)}),fetch(d(t,h))]);case 20:return v=e.sent,x=Object(n["a"])(v,2),x[0],j=x[1],e.t0=a["validatingParse"],e.t1=s,e.next=28,j.text();case 28:if(e.t2=e.sent,k=(0,e.t0)(e.t1,e.t2),void 0!==k){e.next=32;break}return e.abrupt("return",{type:"error",errorCode:"invalid_parcel_format"});case 32:if(u===k.version){e.next=34;break}return e.abrupt("return",{type:"error",errorCode:"different_key_exchange_version"});case 34:return e.next=36,crypto.subtle.importKey("jwk",k.encryptPublicJwk,{name:"ECDH",namedCurve:"P-256"},!1,[]);case 36:return w=e.sent,e.next=39,crypto.subtle.deriveBits({name:"ECDH",public:w},o.privateKey,i);case 39:return m=e.sent,e.next=42,O(p,k.encryptPublicJwk);case 42:return g=e.sent,e.abrupt("return",{type:"key",key:new Uint8Array(m),verificationCode:g});case 44:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function O(e,t){return w.apply(this,arguments)}function w(){return w=Object(c["a"])(regeneratorRuntime.mark((function e(t,r){var n,c,a,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:return n=e.sent,c=n.jwkThumbprintByEncoding,a=[c(t,"SHA-256","hex"),c(r,"SHA-256","hex")],e.next=7,b();case 7:return u=e.sent,e.next=10,u.sha256(a.sort().join("-"));case 10:return e.abrupt("return",e.sent.substring(0,32));case 11:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function m(e,t,r,n){return g.apply(this,arguments)}function g(){return g=Object(c["a"])(regeneratorRuntime.mark((function e(t,r,n,c){var u,i,s,d,l,h,x,k,O,w,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.t0=n.type,e.next="raw"===e.t0?3:"password"===e.t0?4:"passwordless"===e.t0?5:49;break;case 3:return e.abrupt("return",{type:"key",key:void 0});case 4:return e.abrupt("return",{type:"key",key:n.password});case 5:return e.next=7,j(t,"receiver",r);case 7:if(u=e.sent,"error"!==u.type){e.next=11;break}return c({type:"error"}),e.abrupt("return",{type:"error",errorMessage:function(e){return Object(p["a"])(e)["key_exchange_error"](u.errorCode)}});case 11:return i=u.key,s=u.verificationCode,c({type:"verification_code_arrived",verificationCode:s,key:i}),e.next=15,f();case 15:return d=e.sent,e.next=18,y();case 18:return l=e.sent,e.t1=l,e.t2=t,e.next=23,v(r);case 23:return e.t3=e.sent,h=(0,e.t1)(e.t2,e.t3),e.next=27,fetch(h);case 27:return x=e.sent,e.next=30,b();case 30:return k=e.sent,e.t4=k,e.t5=Uint8Array,e.next=35,x.arrayBuffer();case 35:return e.t6=e.sent,e.t7=new e.t5(e.t6),e.t8=i,e.next=40,e.t4.decrypt.call(e.t4,e.t7,e.t8);case 40:if(O=e.sent,w=Object(a["validatingParse"])(o,d(O)),void 0!==w){e.next=44;break}return e.abrupt("return",{type:"error",errorMessage:function(e){return Object(p["a"])(e)["key_exchange_error"]("invalid_parcel_format")}});case 44:if(m=w.verified,c({type:"verified",verified:m}),m){e.next=48;break}return e.abrupt("return",{type:"error",errorMessage:function(e){return Object(p["a"])(e)["sender_not_verified"]}});case 48:return e.abrupt("return",{type:"key",key:i});case 49:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}}}]);
//# sourceMappingURL=piping-ui-auth.daa8cbd8.js.map