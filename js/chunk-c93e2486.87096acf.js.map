{"version":3,"sources":["webpack:///./node_modules/binconv/dist/src/blobToUint8Array.js","webpack:///./node_modules/binconv/dist/src/stringToUint8Array.js","webpack:///./node_modules/binconv/dist/src/blobToArrayBuffer.js","webpack:///./src/components/DataUploader.vue?f6c4","webpack:///./src/components/DataUploader.vue","webpack:///./src/components/DataUploader.vue?7600","webpack:///./src/components/DataUploader.vue?5df2","webpack:///./node_modules/vue-async-computed-decorator/src/index.js"],"names":["Object","defineProperty","exports","value","blobToArrayBuffer_1","blobToUint8Array","blob","blobToArrayBuffer","then","buff","Uint8Array","default","stringToUint8Array","str","numbers","map","call","c","charCodeAt","Promise","resolve","reject","fileReader","FileReader","onload","arrayBuffer","result","onerror","readAsArrayBuffer","render","_vm","this","_h","$createElement","_c","_self","attrs","isDoneUpload","hasError","scopedSlots","_u","key","fn","staticStyle","headerIconColor","_v","_s","headerIcon","proxy","strings","props","uploadNo","isReadyToUpload","progressPercentage","toFixed","protection","type","verificationStep","_e","verificationCode","on","$event","verify","icons","mdiCheck","mdiCancel","directives","name","rawName","expression","ref","_g","readableBytesString","progressSetting","loadedBytes","totalBytes","staticClass","uploadPath","cancelUpload","mdiCloseCircle","domProps","errorMessage","staticRenderFns","undefined","utils","errorMessageDelegate","canceled","isCompressing","isEncrypting","mdi","xhr","XMLHttpRequest","$el","send","password","keyExchange","serverUrl","secretPath","keyExchangeRes","errorCode","verified","Error","verifiedParcel","JSON","stringify","encryptedVerifiedParcel","verifiedPath","path","fetch","method","body","data","Blob","length","files","zipBlob","plainBody","bodyLength","size","plainBodyArray","encrypted","byteLength","open","responseType","upload","onprogress","ev","loaded","total","status","response","responseText","abort","self","notCompressingAndEncrypting","language","components","VerificationCode","component","VAlert","VBtn","VExpansionPanel","VExpansionPanelContent","VExpansionPanelHeader","VFlex","VIcon","VLayout","VProgressLinear","VSimpleTable","VTooltip","AsyncComputed","computedOptions","options","asyncComputed","methods","assign","get"],"mappings":"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","file":"js/chunk-c93e2486.87096acf.js","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar blobToArrayBuffer_1 = require(\"./blobToArrayBuffer\");\nfunction blobToUint8Array(blob) {\n    return blobToArrayBuffer_1.blobToArrayBuffer(blob).then(function (buff) { return new Uint8Array(buff); });\n}\nexports.blobToUint8Array = blobToUint8Array;\nexports.default = blobToUint8Array;\n//# sourceMappingURL=blobToUint8Array.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction stringToUint8Array(str) {\n    var numbers = [].map.call(str, function (c) {\n        return c.charCodeAt(0);\n    });\n    return new Uint8Array(numbers);\n}\nexports.stringToUint8Array = stringToUint8Array;\nexports.default = stringToUint8Array;\n//# sourceMappingURL=stringToUint8Array.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction blobToArrayBuffer(blob) {\n    return new Promise(function (resolve, reject) {\n        var fileReader = new FileReader();\n        fileReader.onload = function () {\n            var arrayBuffer = fileReader.result;\n            resolve(arrayBuffer);\n        };\n        fileReader.onerror = reject;\n        fileReader.readAsArrayBuffer(blob);\n    });\n}\nexports.blobToArrayBuffer = blobToArrayBuffer;\nexports.default = blobToArrayBuffer;\n//# sourceMappingURL=blobToArrayBuffer.js.map","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-expansion-panel',{attrs:{\"active\":\"true\"}},[_c('v-expansion-panel-header',{attrs:{\"disable-icon-rotate\":_vm.isDoneUpload || _vm.hasError},scopedSlots:_vm._u([{key:\"actions\",fn:function(){return [_c('v-icon',{staticStyle:{\"margin-left\":\"0.3em\"},attrs:{\"color\":_vm.headerIconColor}},[_vm._v(\" \"+_vm._s(_vm.headerIcon)+\" \")])]},proxy:true}])},[_c('span',[_vm._v(_vm._s(_vm.strings['upload'])+\" #\"+_vm._s(_vm.props.uploadNo))]),_vm._v(\" \"+_vm._s(_vm.isReadyToUpload ? _vm.progressPercentage && ((_vm.progressPercentage.toFixed(2)) + \" %\") : '')+\" \")]),_c('v-expansion-panel-content',[(_vm.props.protection.type === 'passwordless' && _vm.verificationStep.type === 'initial')?_c('v-alert',{attrs:{\"type\":\"info\"}},[_c('span',{},[_vm._v(_vm._s(_vm.strings['waiting_for_receiver']))])]):_vm._e(),(_vm.props.protection.type === 'passwordless' && _vm.verificationStep.type === 'verification_code_arrived')?_c('span',[_c('VerificationCode',{attrs:{\"value\":_vm.verificationStep.verificationCode}}),_c('v-layout',[_c('v-flex',{attrs:{\"xs6\":\"\"}},[_c('v-btn',{attrs:{\"color\":\"success\",\"block\":\"\"},on:{\"click\":function($event){return _vm.verify(true)}}},[_c('v-icon',{attrs:{\"left\":\"\",\"dark\":\"\"}},[_vm._v(_vm._s(_vm.icons.mdiCheck))]),_vm._v(\" \"+_vm._s(_vm.strings['verify_and_send'])+\" \")],1)],1),_c('v-flex',{attrs:{\"xs6\":\"\"}},[_c('v-btn',{attrs:{\"color\":\"error\",\"block\":\"\"},on:{\"click\":function($event){return _vm.verify(false)}}},[_c('v-icon',{attrs:{\"left\":\"\",\"dark\":\"\"}},[_vm._v(_vm._s(_vm.icons.mdiCancel))]),_vm._v(\" \"+_vm._s(_vm.strings['cancel'])+\" \")],1)],1)],1)],1):_vm._e(),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isCompressing),expression:\"isCompressing\"}]},[_c('div',{staticStyle:{\"text-align\":\"center\"}},[_vm._v(\" \"+_vm._s(_vm.strings['compressing'])+\" \")]),_c('v-progress-linear',{attrs:{\"indeterminate\":\"\"}})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isEncrypting),expression:\"isEncrypting\"}]},[_c('div',{staticStyle:{\"text-align\":\"center\"}},[_vm._v(\" \"+_vm._s(_vm.strings['encrypting'])+\" \")]),_c('v-progress-linear',{attrs:{\"indeterminate\":\"\"}})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isReadyToUpload),expression:\"isReadyToUpload\"}]},[_c('v-tooltip',{attrs:{\"bottom\":\"\"},scopedSlots:_vm._u([{key:\"activator\",fn:function(ref){\nvar on = ref.on;\nreturn [_c('div',_vm._g({staticStyle:{\"text-align\":\"center\"}},on),[_vm._v(\" \"+_vm._s(_vm.readableBytesString(_vm.progressSetting.loadedBytes, 1))+\" of \"+_vm._s(_vm.readableBytesString(_vm.progressSetting.totalBytes, 1))+\" \")])]}}])},[_c('span',[_vm._v(_vm._s(_vm.progressSetting.loadedBytes)+\" of \"+_vm._s(_vm.progressSetting.totalBytes))])]),_c('v-progress-linear',{attrs:{\"value\":_vm.progressPercentage}})],1),_c('v-simple-table',{staticClass:\"text-left\"},[_c('tbody',[_c('tr',{staticClass:\"text-left\"},[_c('td',[_vm._v(_vm._s(_vm.strings['upload_url']))]),_c('td',[_vm._v(_vm._s(_vm.uploadPath))])])])]),(_vm.isCancelable)?_c('div',{staticStyle:{\"text-align\":\"right\"}},[_c('v-btn',{staticClass:\"ma-2 justify-end\",attrs:{\"color\":\"warning\",\"outlined\":\"\"},on:{\"click\":function($event){return _vm.cancelUpload()}}},[_c('v-icon',[_vm._v(_vm._s(_vm.icons.mdiCloseCircle))]),_vm._v(\" \"+_vm._s(_vm.strings['cancel'])+\" \")],1)],1):_vm._e(),_c('v-alert',{attrs:{\"type\":\"error\",\"outlined\":\"\",\"value\":_vm.hasError},domProps:{\"innerHTML\":_vm._s(_vm.errorMessage)}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {Component, Prop, Vue} from 'vue-property-decorator';\nimport urlJoin from 'url-join';\nimport {blobToUint8Array} from 'binconv/dist/src/blobToUint8Array';\nimport {stringToUint8Array} from 'binconv/dist/src/stringToUint8Array';\n\nimport * as utils from '@/utils';\nimport * as pipingUiUtils from \"@/piping-ui-utils\";\nimport {globalStore} from \"@/vue-global\";\nimport {strings} from \"@/strings\";\nimport {mdiAlert, mdiCancel, mdiCheck, mdiChevronDown, mdiCloseCircle} from \"@mdi/js\";\nimport AsyncComputed from 'vue-async-computed-decorator';\nimport type {Protection, VerificationStep, VerifiedParcel} from \"@/datatypes\";\nimport VerificationCode from \"@/components/VerificationCode.vue\";\nimport {pipingUiAuthAsync} from \"@/pipingUiAuthWithWebpackChunkName\"\n\n\nexport type DataUploaderProps = {\n  uploadNo: number,\n  data: File[] | string,\n  serverUrl: string,\n  secretPath: string,\n  protection: Protection,\n};\n\n// NOTE: Automatically upload when mounted\n@Component({\n  components: {\n    VerificationCode,\n  },\n})\nexport default class DataUploader extends Vue {\n  @Prop() private props!: DataUploaderProps;\n\n  // Progress bar setting\n  private progressSetting: {loadedBytes: number, totalBytes?: number} = {\n    loadedBytes: 0,\n    totalBytes: undefined,\n  };\n\n  private readableBytesString = utils.readableBytesString;\n\n  // NOTE: Function makes dynamic language-switch support possible\n  //       Delegation is to reassign this value\n  private errorMessageDelegate: () => string | Promise<string> =\n    () => \"\";\n  @AsyncComputed()\n  async errorMessage(): Promise<string> {\n    return this.errorMessageDelegate();\n  }\n  private xhr: XMLHttpRequest;\n  private canceled: boolean = false;\n  private isCompressing: boolean = false;\n  private isEncrypting: boolean = false;\n  private verificationStep: VerificationStep = {type: 'initial'};\n\n  private icons = {\n    mdiCloseCircle,\n    mdiCheck,\n    mdiCancel,\n  };\n\n  private get progressPercentage(): number | null {\n    if (this.progressSetting.totalBytes === undefined) {\n      return null;\n    } else if (this.progressSetting.totalBytes === 0) {\n      return 100;\n    } else {\n      return this.progressSetting.loadedBytes / this.progressSetting.totalBytes * 100;\n    }\n  }\n\n  private get isDoneUpload(): boolean {\n    return this.progressPercentage === 100;\n  }\n\n  private get uploadPath(): string {\n    return urlJoin(this.props.serverUrl, this.props.secretPath);\n  }\n\n  @AsyncComputed()\n  private async hasError(): Promise<boolean> {\n    return await this.errorMessageDelegate() !== \"\";\n  }\n\n  private get headerIcon(): string {\n    // NOTE: getter `hasError` is created by @AsyncComputed\n    const self = (this as unknown as {hasError: boolean});\n    if (self.hasError) {\n      return mdiAlert;\n    } else if (this.canceled) {\n      return mdiCloseCircle;\n    } else if (this.isDoneUpload) {\n      return mdiCheck;\n    } else {\n      return mdiChevronDown;\n    }\n  }\n\n  private get headerIconColor(): string | undefined {\n    // NOTE: Getter `hasError` is created by @AsyncComputed\n    const self = (this as unknown as {hasError: boolean});\n    if (self.hasError) {\n      return \"error\";\n    } else if (this.canceled) {\n      return \"warning\";\n    } else if (this.isDoneUpload) {\n      return \"teal\";\n    } else {\n      return undefined\n    }\n  }\n\n  private get isCancelable(): boolean {\n    return this.isReadyToUpload && !this.isDoneUpload && !this.hasError && !this.canceled;\n  }\n\n  private get isReadyToUpload(): boolean {\n    const notCompressingAndEncrypting = !this.isCompressing && !this.isEncrypting;\n    if (this.props.protection.type === 'passwordless') {\n      return this.verificationStep.type === 'verified' && this.verificationStep.verified && notCompressingAndEncrypting;\n    } else {\n      return notCompressingAndEncrypting;\n    }\n  }\n\n  // for language support\n  private get strings() {\n    return strings(globalStore.language);\n  }\n\n  constructor() {\n    super();\n    this.xhr = new XMLHttpRequest();\n  }\n\n  async mounted() {\n    // Scroll to this element\n    // NOTE: no need to add `await`\n    pipingUiUtils.scrollTo(this.$el);\n\n    switch (this.props.protection.type) {\n      case 'raw':\n        // Send\n        await this.send(undefined);\n        break;\n      case 'password':\n        // Send\n        await this.send(this.props.protection.password);\n        break;\n      case 'passwordless': {\n        // Key exchange\n        const keyExchangeRes = await (await pipingUiAuthAsync).keyExchange(this.props.serverUrl, 'sender', this.props.secretPath);\n        if (keyExchangeRes.type === 'error') {\n          this.verificationStep = {type: 'error'};\n          this.errorMessageDelegate = () => this.strings['key_exchange_error'](keyExchangeRes.errorCode);\n          return;\n        }\n        const {key, verificationCode} = keyExchangeRes;\n        this.verificationStep = {type: 'verification_code_arrived', verificationCode, key};\n        break;\n      }\n    }\n  }\n\n  private async verify(verified: boolean) {\n    if (this.verificationStep.type !== 'verification_code_arrived') {\n      throw new Error(\"Unexpected state: this.verificationStep.type should be 'verification_code_arrived'\");\n    }\n    const {key} = this.verificationStep;\n    this.verificationStep = {type: 'verified', verified};\n\n\n    const verifiedParcel: VerifiedParcel = {\n      verified,\n    };\n    const encryptedVerifiedParcel = await utils.encrypt(\n      stringToUint8Array(JSON.stringify(verifiedParcel)),\n      key,\n    );\n    const path = urlJoin(this.props.serverUrl, await (await pipingUiAuthAsync).verifiedPath(this.props.secretPath));\n    // Send verified or not\n    await fetch(path, {\n      method: 'POST',\n      body: encryptedVerifiedParcel,\n    });\n\n    // If verified, send\n    if (verified) {\n      await this.send(key);\n    }\n  }\n\n  private async send(password: string | Uint8Array | undefined) {\n    const data: File[] | string = this.props.data;\n\n    const plainBody: Blob = await (async () => {\n      // Text\n      if (typeof data === \"string\") {\n        return new Blob([data]);\n        // One file\n      } else if (data.length === 1) {\n        return data[0];\n        // Multiple files\n      } else {\n        const files: File[] = data;\n        this.isCompressing = true;\n        // Zip files\n        const zipBlob: Blob = await utils.zipFilesAsBlob(files);\n        this.isCompressing = false;\n        return zipBlob;\n      }\n    })();\n\n    const {body, bodyLength} = await (async () => {\n      // If password protection is disabled\n      if (password === undefined) {\n        // Return as plain\n        return {body: plainBody, bodyLength: plainBody.size};\n      } else {\n        this.isEncrypting = true;\n        // Convert plain body blob to Uint8Array\n        const plainBodyArray: Uint8Array = await blobToUint8Array(plainBody);\n        // Get encrypted\n        // NOTE: In the future, ReadableStream can be uploaded.\n        // (see: https://github.com/whatwg/fetch/pull/425#issuecomment-518899855)\n        const encrypted: Uint8Array = await utils.encrypt(plainBodyArray, password);\n        this.isEncrypting = false;\n        return {body: encrypted, bodyLength: encrypted.byteLength};\n      }\n    })();\n\n    // Send\n    this.xhr.open('POST', this.uploadPath, true);\n    this.xhr.responseType = 'text';\n    // Update progress bar\n    this.xhr.upload.onprogress = (ev) => {\n      this.progressSetting.loadedBytes = ev.loaded;\n      this.progressSetting.totalBytes  = ev.total;\n    };\n    this.xhr.upload.onload = () => {\n      // Send finished\n      if (this.xhr.status === 200) {\n        if (this.progressSetting.totalBytes !== undefined) {\n          this.progressSetting.loadedBytes = this.progressSetting.totalBytes;\n        }\n      }\n    };\n    this.xhr.onload = () => {\n      if (this.xhr.status !== 200) {\n        this.errorMessageDelegate = () => this.strings['xhr_status_error']({\n          status: this.xhr.status,\n          response: this.xhr.responseText\n        });\n      }\n    };\n    this.xhr.onerror = (ev) => {\n      this.errorMessageDelegate = () => this.strings['data_uploader_xhr_onerror']({serverUrl: this.props.serverUrl});\n    };\n    this.xhr.upload.onerror = () => {\n      this.errorMessageDelegate = () => this.strings['data_uploader_xhr_upload_onerror'];\n    };\n    this.xhr.send(body);\n    // Initialize progress bar\n    this.progressSetting.loadedBytes = 0;\n    this.progressSetting.totalBytes = bodyLength;\n  }\n\n  private cancelUpload(): void {\n    this.xhr.abort();\n    this.canceled = true;\n  }\n}\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataUploader.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DataUploader.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./DataUploader.vue?vue&type=template&id=3d76ea36&scoped=true&\"\nimport script from \"./DataUploader.vue?vue&type=script&lang=ts&\"\nexport * from \"./DataUploader.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3d76ea36\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAlert } from 'vuetify/lib/components/VAlert';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VFlex } from 'vuetify/lib/components/VGrid';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VLayout } from 'vuetify/lib/components/VGrid';\nimport { VProgressLinear } from 'vuetify/lib/components/VProgressLinear';\nimport { VSimpleTable } from 'vuetify/lib/components/VDataTable';\nimport { VTooltip } from 'vuetify/lib/components/VTooltip';\ninstallComponents(component, {VAlert,VBtn,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VFlex,VIcon,VLayout,VProgressLinear,VSimpleTable,VTooltip})\n","import { createDecorator } from 'vue-class-component'\n\nexport default function AsyncComputed (computedOptions) {\n  return createDecorator((options, key) => {\n    options.asyncComputed = options.asyncComputed || {}\n    const method = options.methods[key]\n    options.asyncComputed[key] = Object.assign(\n      { get: method },\n      computedOptions\n    )\n    delete options.methods[key]\n  })\n}\n"],"sourceRoot":""}