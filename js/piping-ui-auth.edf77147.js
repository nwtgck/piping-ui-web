(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["piping-ui-auth"],{acf5:function(e,r,t){"use strict";t.r(r),t.d(r,"verifiedPath",(function(){return x})),t.d(r,"keyExchange",(function(){return k})),t.d(r,"keyExchangeAndReceiveVerified",(function(){return j}));var n=t("3835"),a=t("1da1"),c=(t("96cf"),t("d3b7"),t("3ca3"),t("ddb0"),t("99af"),t("e9c4"),t("ace4"),t("5cc6"),t("907a"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),t("fa9e"),t("77d9"),t("a15b"),t("4e827"),t("8fe2")),u=c["f"]({d:c["g"],r:c["g"],t:c["g"]}),i=c["c"]([c["h"]({kty:c["d"]("EC")}),c["f"]({alg:c["g"],crv:c["g"],d:c["g"],dp:c["g"],dq:c["g"],e:c["g"],ext:c["b"],k:c["g"],key_ops:c["a"](c["g"]),n:c["g"],oth:c["a"](u),p:c["g"],q:c["g"],qi:c["g"],use:c["g"],x:c["g"],y:c["g"]})]),s=c["h"]({version:c["e"]}),o=c["h"]({version:c["d"](1),encryptPublicJwk:i}),p=c["h"]({verified:c["b"]}),d=t("1579"),f=function(){return Promise.resolve().then(t.bind(null,"7dda"))},y=function(){return Promise.all([t.e("chunk-594d6d48"),t.e("chunk-0c80c866")]).then(t.t.bind(null,"62f3",7))},b=function(){return t.e("chunk-2d21e767").then(t.t.bind(null,"d654",7)).then((function(e){return e.uint8ArrayToString}))},h=function(){return Promise.resolve().then(t.t.bind(null,"4ff6",7)).then((function(e){return e.default}))};function l(e,r){return g.apply(this,arguments)}function g(){return g=Object(a["a"])(regeneratorRuntime.mark((function e(r,t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return n=e.sent,e.abrupt("return",n.sha256("".concat(t,"/key_exchange/").concat(r)));case 4:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return v=Object(a["a"])(regeneratorRuntime.mark((function e(r){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return t=e.sent,e.abrupt("return",t.sha256("".concat(r,"/verified")));case 4:case"end":return e.stop()}}),e)}))),v.apply(this,arguments)}function k(e,r,t){return w.apply(this,arguments)}function w(){return w=Object(a["a"])(regeneratorRuntime.mark((function e(r,t,a){var c,u,i,p,d,f,y,b,g,x,v,k,w,_,j,C,O,P;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c=1,u=256,e.next=4,window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey","deriveBits"]);case 4:return i=e.sent,e.next=7,crypto.subtle.exportKey("jwk",i.publicKey);case 7:return p=e.sent,d={version:c,encryptPublicJwk:p},e.next=11,h();case 11:return f=e.sent,e.next=14,l(t,a);case 14:return y=e.sent,e.next=17,l("sender"===t?"receiver":"sender",a);case 17:return b=e.sent,e.next=20,Promise.all([fetch(f(r,y),{method:"POST",body:JSON.stringify(d)}),fetch(f(r,b))]);case 20:return g=e.sent,x=Object(n["a"])(g,2),v=x[1],e.t0=s,e.t1=JSON,e.next=27,v.text();case 27:if(e.t2=e.sent,e.t3=e.t1.parse.call(e.t1,e.t2),k=e.t0.decode.call(e.t0,e.t3),"Left"!==k._tag){e.next=32;break}return e.abrupt("return",{type:"error",errorCode:"invalid_parcel_format"});case 32:if(w=k.right,c===w.version){e.next=35;break}return e.abrupt("return",{type:"error",errorCode:"different_key_exchange_version"});case 35:if(_=o.decode(w),"Left"!==_._tag){e.next=38;break}return e.abrupt("return",{type:"error",errorCode:"invalid_v1_parcel_format"});case 38:return j=_.right,e.next=41,crypto.subtle.importKey("jwk",j.encryptPublicJwk,{name:"ECDH",namedCurve:"P-256"},!1,[]);case 41:return C=e.sent,e.next=44,crypto.subtle.deriveBits({name:"ECDH",public:C},i.privateKey,u);case 44:return O=e.sent,e.next=47,m(p,j.encryptPublicJwk);case 47:return P=e.sent,e.abrupt("return",{type:"key",key:new Uint8Array(O),verificationCode:P});case 49:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function m(e,r){return _.apply(this,arguments)}function _(){return _=Object(a["a"])(regeneratorRuntime.mark((function e(r,t){var n,a,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,y();case 2:return n=e.sent,a=n.jwkThumbprintByEncoding,c=[a(r,"SHA-256","hex"),a(t,"SHA-256","hex")],e.next=7,f();case 7:return u=e.sent,e.next=10,u.sha256(c.sort().join("-"));case 10:return e.abrupt("return",e.sent.substring(0,32));case 11:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}function j(e,r,t,n){return C.apply(this,arguments)}function C(){return C=Object(a["a"])(regeneratorRuntime.mark((function e(r,t,n,a){var c,u,i,s,o,y,l,g,v,w,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.t0=n.type,e.next="raw"===e.t0?3:"password"===e.t0?4:"passwordless"===e.t0?5:49;break;case 3:return e.abrupt("return",{type:"key",key:void 0});case 4:return e.abrupt("return",{type:"key",key:n.password});case 5:return e.next=7,k(r,"receiver",t);case 7:if(c=e.sent,"error"!==c.type){e.next=11;break}return a({type:"error"}),e.abrupt("return",{type:"error",errorMessage:function(e){return Object(d["a"])(e)["key_exchange_error"](c.errorCode)}});case 11:return u=c.key,i=c.verificationCode,a({type:"verification_code_arrived",verificationCode:i,key:u}),e.next=15,b();case 15:return s=e.sent,e.next=18,h();case 18:return o=e.sent,e.t1=o,e.t2=r,e.next=23,x(t);case 23:return e.t3=e.sent,y=(0,e.t1)(e.t2,e.t3),e.next=27,fetch(y);case 27:return l=e.sent,e.next=30,f();case 30:return g=e.sent,e.t4=g,e.t5=Uint8Array,e.next=35,l.arrayBuffer();case 35:return e.t6=e.sent,e.t7=new e.t5(e.t6),e.t8=u,e.next=40,e.t4.decrypt.call(e.t4,e.t7,e.t8);case 40:if(v=e.sent,w=p.decode(JSON.parse(s(v))),"Left"!==w._tag){e.next=44;break}return e.abrupt("return",{type:"error",errorMessage:function(e){return Object(d["a"])(e)["key_exchange_error"]("invalid_parcel_format")}});case 44:if(m=w.right.verified,a({type:"verified",verified:m}),m){e.next=48;break}return e.abrupt("return",{type:"error",errorMessage:function(e){return Object(d["a"])(e)["sender_not_verified"]}});case 48:return e.abrupt("return",{type:"key",key:u});case 49:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}}}]);
//# sourceMappingURL=piping-ui-auth.edf77147.js.map